<!DOCTYPE html>
<html>
	<head>
  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
	</head>
	<body>
		<pre id="state" />
		<script type="text/javascript">
			"use strict";
			var room_name = window.location.path.split("/").pop();
			var state_elem = document.getElementById("state");
			var next_index = "0";

			function fetch_state() {
				var xhr = new XMLHttpRequest();
				xhr.onload = function() {
					var response = JSON.parse(xhr.responseText)
					next_index = response["index"]

					state_elem.innerHTML = PR.prettyPrintOne(JSON.stringify(response["room"], undefined, 2), "js");
					setTimeout(fetch_state, 0);
				};
				xhr.ontimeout = function() {
					setTimeout(fetch_state, 0);
				};
				xhr.open("GET", "/api/room/" + room_name + "?index=" + next_index);
				xhr.timeout = 120000;
				xhr.send();
			}
			fetch_state();
		</script>
	</body>
</html>
